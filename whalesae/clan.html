<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clan Detail - WhaleSAE</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <a href="codalm.html" class="back-link">&larr; Back</a>
    <h1 id="clan-title">Loading...</h1>
    <p id="clan-stats" class="stats"></p>

    <div class="section-card">
      <h2>Most enriched features</h2>
      <p class="section-desc">Highest enrichment score for this clan â€” how much more a feature fires here compared to the overall rate.</p>
      <div id="enriched-list" class="grid-3"></div>
    </div>

    <div class="section-card">
      <h2>Most selective features</h2>
      <p class="section-desc">Features that fire most exclusively on examples from this clan.</p>
      <div id="selective-list" class="grid-3"></div>
    </div>

    <footer>WhaleSAE &middot; Sparse Autoencoders for Sperm Whale Communication</footer>
  </div>

  <script>
  var clanName = new URLSearchParams(window.location.search).get('name');

  function featureCard(f, scoreKey, scoreLabel) {
    var pct = (f.firing_rate * 100).toFixed(1);
    return '<a href="codalm-feature.html?id=' + f.idx + '" class="card">' +
      '<div class="grid-card-name">F' + f.idx + '</div>' +
      '<div class="grid-card-meta">' +
        '<span>' + scoreLabel + ' <strong>' + f[scoreKey].toFixed(2) + '</strong></span>' +
        '<span>' + pct + '% firing</span>' +
      '</div>' +
      '<div class="rate-bar"><div class="rate-bar-fill" style="width:' + Math.min(100, f.firing_rate * 100 / 40 * 100).toFixed(0) + '%"></div></div>' +
    '</a>';
  }

  async function load() {
    var results = await Promise.all([
      fetch('data/codalm-clans.json'),
      fetch('data/codalm-overview.json')
    ]);
    var clansData = await results[0].json();
    var overview = await results[1].json();

    var clan = clansData[clanName];
    if (!clan) { document.getElementById('clan-title').textContent = 'Clan not found'; return; }

    document.title = 'Clan ' + clanName + ' - WhaleSAE';
    document.getElementById('clan-title').textContent = 'Clan ' + clanName;
    document.getElementById('clan-stats').innerHTML =
      '<strong>' + clan.n_examples + '</strong> examples &middot; <strong>' + clan.n_active_features + '</strong> active features';

    var enriched = (clan.top_enriched || []).slice(0, 12);
    document.getElementById('enriched-list').innerHTML =
      enriched.map(function(f) { return featureCard(f, 'enrichment', 'Enrichment'); }).join('');

    var selective = (clan.top_selective || []).slice(0, 12);
    document.getElementById('selective-list').innerHTML =
      selective.map(function(f) { return featureCard(f, 'selectivity', 'Selectivity'); }).join('');
  }
  load();
  </script>
</body>
</html>
